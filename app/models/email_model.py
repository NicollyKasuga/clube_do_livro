from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
import smtplib, ssl
from os import getenv
from dotenv import load_dotenv

load_dotenv()


class Email:
    email_from = getenv("EMAIL_FROM")
    password = getenv("PASS_EMAIL")

    def __init__(self, email_to_send, token) -> None:
        self.email_to_send = email_to_send
        self.subject = "Confirme seu Email!"
        self.token = token

    def send_email(self):
        email = MIMEMultipart()

        email["From"] = self.email_from
        email["To"] = self.email_to_send
        email["Subject"] = self.subject

        html = """\
                <!doctype html><html âš¡4email data-css-strict><head><meta charset="utf-8"><style amp4email-boilerplate>body visibility:hidden </style><script async src="https://cdn.ampproject.org/v0.js"></script><style amp-custom>.es-desk-hidden {	display:none;	float:left;	overflow:hidden;	width:0;	max-height:0;	line-height:0;}body {	width:100%;	font-family:arial, "helvetica neue", helvetica, sans-serif;}table {	border-collapse:collapse;	border-spacing:0px;}table td, body, .es-wrapper {	padding:0;	Margin:0;}.es-content, .es-header, .es-footer {	table-layout:fixed;	width:100%;}p, hr {	Margin:0;}h1, h2, h3, h4, h5 {	Margin:0;	line-height:120%;	font-family:arial, "helvetica neue", helvetica, sans-serif;}.es-left {	float:left;}.es-right {	float:right;}.es-p5 {	padding:5px;}.es-p5t {	padding-top:5px;}.es-p5b {	padding-bottom:5px;}.es-p5l {	padding-left:5px;}.es-p5r {	padding-right:5px;}.es-p10 {	padding:10px;}.es-p10t {	padding-top:10px;}.es-p10b {	padding-bottom:10px;}.es-p10l {	padding-left:10px;}.es-p10r {	padding-right:10px;}.es-p15 {	padding:15px;}.es-p15t {	padding-top:15px;}.es-p15b {	padding-bottom:15px;}.es-p15l {	padding-left:15px;}.es-p15r {	padding-right:15px;}.es-p20 {	padding:20px;}.es-p20t {	padding-top:20px;}.es-p20b {	padding-bottom:20px;}.es-p20l {	padding-left:20px;}.es-p20r {	padding-right:20px;}.es-p25 {	padding:25px;}.es-p25t {	padding-top:25px;}.es-p25b {	padding-bottom:25px;}.es-p25l {	padding-left:25px;}.es-p25r {	padding-right:25px;}.es-p30 {	padding:30px;}.es-p30t {	padding-top:30px;}.es-p30b {	padding-bottom:30px;}.es-p30l {	padding-left:30px;}.es-p30r {	padding-right:30px;}.es-p35 {	padding:35px;}.es-p35t {	padding-top:35px;}.es-p35b {	padding-bottom:35px;}.es-p35l {	padding-left:35px;}.es-p35r {	padding-right:35px;}.es-p40 {	padding:40px;}.es-p40t {	padding-top:40px;}.es-p40b {	padding-bottom:40px;}.es-p40l {	padding-left:40px;}.es-p40r {	padding-right:40px;}.es-menu td {	border:0;}s {	text-decoration:line-through;}p, ul li, ol li {	font-family:arial, "helvetica neue", helvetica, sans-serif;	line-height:150%;}ul li, ol li {	Margin-bottom:15px;	margin-left:0;}a {	text-decoration:underline;}.es-menu td a {	text-decoration:none;	display:block;	font-family:arial, "helvetica neue", helvetica, sans-serif;}.es-menu amp-img, .es-button amp-img {	vertical-align:middle;}.es-wrapper {	width:100%;	height:100%;	background-color:#FAFAFA;}.es-wrapper-color {	background-color:#FAFAFA;}.es-header {	background-color:transparent;}.es-header-body {	background-color:transparent;}.es-header-body p, .es-header-body ul li, .es-header-body ol li {	color:#333333;	font-size:14px;}.es-header-body a {	color:#666666;	font-size:14px;}.es-content-body {	background-color:#FFFFFF;}.es-content-body p, .es-content-body ul li, .es-content-body ol li {	color:#333333;	font-size:14px;}.es-content-body a {	color:#5C68E2;	font-size:14px;}.es-footer {	background-color:transparent;}.es-footer-body {	background-color:#FFFFFF;}.es-footer-body p, .es-footer-body ul li, .es-footer-body ol li {	color:#333333;	font-size:12px;}.es-footer-body a {	color:#333333;	font-size:12px;}.es-infoblock, .es-infoblock p, .es-infoblock ul li, .es-infoblock ol li {	line-height:120%;	font-size:12px;	color:#CCCCCC;}.es-infoblock a {	font-size:12px;	color:#CCCCCC;}h1 {	font-size:46px;	font-style:normal;	font-weight:bold;	color:#333333;}h2 {	font-size:26px;	font-style:normal;	font-weight:bold;	color:#333333;}h3 {	font-size:20px;	font-style:normal;	font-weight:bold;	color:#333333;}.es-header-body h1 a, .es-content-body h1 a, .es-footer-body h1 a {	font-size:46px;}.es-header-body h2 a, .es-content-body h2 a, .es-footer-body h2 a {	font-size:26px;}.es-header-body h3 a, .es-content-body h3 a, .es-footer-body h3 a {	font-size:20px;}a.es-button, button.es-button {	border-style:solid;	border-color:#5C68E2;	border-width:10px 30px 10px 30px;	display:inline-block;	background:#5C68E2;	border-radius:0px;	font-size:20px;	font-family:arial, "helvetica neue", helvetica, sans-serif;	font-weight:normal;	font-style:normal;	line-height:120%;	color:#FFFFFF;	text-decoration:none;	width:auto;	text-align:center;}.es-button-border {	border-style:solid solid solid solid;	border-color:#2CB543 #2CB543 #2CB543 #2CB543;	background:#5C68E2;	border-width:0px 0px 0px 0px;	display:inline-block;	border-radius:0px;	width:auto;}body {	font-family:arial, "helvetica neue", helvetica, sans-serif;}@media only screen and (max-width:600px) {p, ul li, ol li, a { line-height:150% } h1, h2, h3, h1 a, h2 a, h3 a { line-height:120% } h1 { font-size:36px; text-align:left } h2 { font-size:26px; text-align:left } h3 { font-size:20px; text-align:left } .es-header-body h1 a, .es-content-body h1 a, .es-footer-body h1 a { font-size:36px; text-align:left } .es-header-body h2 a, .es-content-body h2 a, .es-footer-body h2 a { font-size:26px; text-align:left } .es-header-body h3 a, .es-content-body h3 a, .es-footer-body h3 a { font-size:20px; text-align:left } .es-menu td a { font-size:12px } .es-header-body p, .es-header-body ul li, .es-header-body ol li, .es-header-body a { font-size:14px } .es-content-body p, .es-content-body ul li, .es-content-body ol li, .es-content-body a { font-size:16px } .es-footer-body p, .es-footer-body ul li, .es-footer-body ol li, .es-footer-body a { font-size:14px } .es-infoblock p, .es-infoblock ul li, .es-infoblock ol li, .es-infoblock a { font-size:12px } *[class="gmail-fix"] { display:none } .es-m-txt-c, .es-m-txt-c h1, .es-m-txt-c h2, .es-m-txt-c h3 { text-align:center } .es-m-txt-r, .es-m-txt-r h1, .es-m-txt-r h2, .es-m-txt-r h3 { text-align:right } .es-m-txt-l, .es-m-txt-l h1, .es-m-txt-l h2, .es-m-txt-l h3 { text-align:left } .es-m-txt-r amp-img { float:right } .es-m-txt-c amp-img { margin:0 auto } .es-m-txt-l amp-img { float:left } .es-button-border { display:inline-block } a.es-button, button.es-button { font-size:20px; display:inline-block } .es-adaptive table, .es-left, .es-right { width:100% } .es-content table, .es-header table, .es-footer table, .es-content, .es-footer, .es-header { width:100%; max-width:600px } .es-adapt-td { display:block; width:100% } .adapt-img { width:100%; height:auto } td.es-m-p0 { padding:0 } td.es-m-p0r { padding-right:0 } td.es-m-p0l { padding-left:0 } td.es-m-p0t { padding-top:0 } td.es-m-p0b { padding-bottom:0 } td.es-m-p20b { padding-bottom:20px } .es-mobile-hidden, .es-hidden { display:none } tr.es-desk-hidden, td.es-desk-hidden, table.es-desk-hidden { width:auto; overflow:visible; float:none; max-height:inherit; line-height:inherit } tr.es-desk-hidden { display:table-row } table.es-desk-hidden { display:table } td.es-desk-menu-hidden { display:table-cell } .es-menu td { width:1% } table.es-table-not-adapt, .esd-block-html table { width:auto } table.es-social { display:inline-block } table.es-social td { display:inline-block } td.es-m-p5 { padding:5px } td.es-m-p5t { padding-top:5px } td.es-m-p5b { padding-bottom:5px } td.es-m-p5r { padding-right:5px } td.es-m-p5l { padding-left:5px } td.es-m-p10 { padding:10px } td.es-m-p10t { padding-top:10px } td.es-m-p10b { padding-bottom:10px } td.es-m-p10r { padding-right:10px } td.es-m-p10l { padding-left:10px } td.es-m-p15 { padding:15px } td.es-m-p15t { padding-top:15px } td.es-m-p15b { padding-bottom:15px } td.es-m-p15r { padding-right:15px } td.es-m-p15l { padding-left:15px } td.es-m-p20 { padding:20px } td.es-m-p20t { padding-top:20px } td.es-m-p20r { padding-right:20px } td.es-m-p20l { padding-left:20px } td.es-m-p25 { padding:25px } td.es-m-p25t { padding-top:25px } td.es-m-p25b { padding-bottom:25px } td.es-m-p25r { padding-right:25px } td.es-m-p25l { padding-left:25px } td.es-m-p30 { padding:30px } td.es-m-p30t { padding-top:30px } td.es-m-p30b { padding-bottom:30px } td.es-m-p30r { padding-right:30px } td.es-m-p30l { padding-left:30px } td.es-m-p35 { padding:35px } td.es-m-p35t { padding-top:35px } td.es-m-p35b { padding-bottom:35px } td.es-m-p35r { padding-right:35px } td.es-m-p35l { padding-left:35px } td.es-m-p40 { padding:40px } td.es-m-p40t { padding-top:40px } td.es-m-p40b { padding-bottom:40px } td.es-m-p40r { padding-right:40px } td.es-m-p40l { padding-left:40px } }</style></head>
                <body><div class="es-wrapper-color"> <!--[if gte mso 9]><v:background xmlns:v="urn:schemas-microsoft-com:vml" fill="t"> <v:fill type="tile" color="#fafafa"></v:fill> </v:background><![endif]--><table class="es-wrapper" width="100%" cellspacing="0" cellpadding="0"><tr><td valign="top"><table class="es-content" cellspacing="0" cellpadding="0" align="center"><tr><td class="es-info-area" align="center"><table class="es-content-body" style="background-color: transparent" width="600" cellspacing="0" cellpadding="0" bgcolor="rgba(0, 0, 0, 0)" align="center"><tr><td class="es-p20" align="left"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="560" valign="top" align="center"><table width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-infoblock" align="center"></td></tr></table></td></tr></table></td></tr></table></td>
                </tr></table><table class="es-header" cellspacing="0" cellpadding="0" align="center"><tr><td align="center"><table class="es-header-body" style="background-color: #2d405f" width="600" cellspacing="0" cellpadding="0" bgcolor="#2d405f" align="center"><tr><td class="es-p10t es-p10b es-p20r es-p20l" align="left"><table width="100%" cellspacing="0" cellpadding="0"><tr><td class="es-m-p0r" width="560" valign="top" align="center"><table width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-p20b es-m-txt-l" style="font-size: 0px" align="center"><amp-img src="https://jeijcq.stripocdn.email/content/guids/CABINET_8abb6bf2ab9c5edf58f0b039d4f8e434/images/clube_do_livroremovebgpreview.png" alt="Logo" style="display: block;font-size: 12px" title="Logo" width="200" height="200"></amp-img></td></tr></table></td></tr></table></td></tr></table></td>
                </tr></table><table class="es-content" cellspacing="0" cellpadding="0" align="center"><tr><td align="center"><table class="es-content-body" width="600" cellspacing="0" cellpadding="0" bgcolor="#ffffff" align="center"><tr><td class="es-p30t es-p30b es-p20r es-p20l" align="left"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="560" valign="top" align="center"><table width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-p10t es-p10b" style="font-size: 0px" align="center"><amp-img src="https://jeijcq.stripocdn.email/content/guids/CABINET_67e080d830d87c17802bd9b4fe1c0912/images/55191618237638326.png" alt style="display: block" width="100" height="72"></amp-img></td></tr><tr><td class="es-p10b es-m-txt-c" align="center"><h1 style="font-size: 46px;line-height: 46px">Confirme seu Email<br></h1></td>
                </tr><tr><td class="es-p5t es-p5b es-p40r es-p40l es-m-p0r es-m-p0l" align="center"><p>VocÃª recebeu esta mensagem porque seu endereÃ§o de e-mail foi registrado em nosso site. Clique no botÃ£o abaixo para verificar seu endereÃ§o de e-mail e confirmar que vocÃª Ã© o proprietÃ¡rio desta conta.</p></td></tr><tr><td class="es-p10t es-p5b" align="center"><p>Se vocÃª nÃ£o se cadastrou conosco, desconsidere este e-mail.</p></td></tr><tr><td class="es-p10t es-p10b" align="center"><span class="es-button-border" style="border-radius: 6px;background: #78c9cb "><a href="https://clube-do-livro-g15.herokuapp.com/api/confirmacao_de_email/""" + self.token + """ " class="es-button" target="_blank" style="border-left-width: 30px;border-right-width: 30px;border-radius: 6px;background: #78c9cb ;border-color: #78c9cb">CONFIRME SEU EMAIL</a></span></td></tr><tr><td class="es-p5t es-p5b es-p40r es-p40l es-m-p0r es-m-p0l" align="center"><p>Uma vez confirmado, este e-mail serÃ¡ associado exclusivamente Ã  sua conta.</p></td></tr></table></td></tr></table></td>
                </tr></table></td></tr></table><table class="es-footer" cellspacing="0" cellpadding="0" align="center"><tr><td align="center"><table class="es-footer-body" style="background-color: transparent" width="640" cellspacing="0" cellpadding="0" align="center"><tr><td class="es-p20t es-p20b es-p20r es-p20l" align="left"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="600" align="left"><table width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-p15t es-p15b" style="font-size:0" align="center"><table class="es-table-not-adapt es-social" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-p40r" valign="top" align="center"><amp-img title="Facebook" src="https://jeijcq.stripocdn.email/content/assets/img/social-icons/logo-black/facebook-logo-black.png" alt="Fb" width="32" height="32"></amp-img></td>
                <td class="es-p40r" valign="top" align="center"><amp-img title="Twitter" src="https://jeijcq.stripocdn.email/content/assets/img/social-icons/logo-black/twitter-logo-black.png" alt="Tw" width="32" height="32"></amp-img></td><td class="es-p40r" valign="top" align="center"><amp-img title="Instagram" src="https://jeijcq.stripocdn.email/content/assets/img/social-icons/logo-black/instagram-logo-black.png" alt="Inst" width="32" height="32"></amp-img></td><td valign="top" align="center"><amp-img title="Youtube" src="https://jeijcq.stripocdn.email/content/assets/img/social-icons/logo-black/youtube-logo-black.png" alt="Yt" width="32" height="32"></amp-img></td></tr></table></td></tr><tr><td class="es-p35b" align="center"><p>Nicolly Kasuga | Rafael Carvalho | Rodrigo Abreu | Luana Gomes | DÃ©bora Gama</p></td>
                </tr><tr><td><table class="es-menu" width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr class="links"><td class="es-p10t es-p10b es-p5r es-p5l" style="padding-top: 5px;padding-bottom: 5px" width="33.33%" valign="top" align="center"><a target="_blank" href="https://" style="color: #999999">Visit Us </a></td><td class="es-p10t es-p10b es-p5r es-p5l" style="padding-top: 5px;padding-bottom: 5px;border-left: 1px solid #cccccc" width="33.33%" valign="top" align="center"><a target="_blank" href="https://" style="color: #999999">Privacy Policy</a></td><td class="es-p10t es-p10b es-p5r es-p5l" style="padding-top: 5px;padding-bottom: 5px;border-left: 1px solid #cccccc" width="33.33%" valign="top" align="center"><a target="_blank" href="https://" style="color: #999999">Terms of Use</a></td></tr></table></td></tr></table></td></tr></table></td></tr></table></td>
                </tr></table><table class="es-content" cellspacing="0" cellpadding="0" align="center"><tr><td class="es-info-area" align="center"><table class="es-content-body" style="background-color: transparent" width="600" cellspacing="0" cellpadding="0" bgcolor="rgba(0, 0, 0, 0)" align="center"><tr><td class="es-p20" align="left"><table width="100%" cellspacing="0" cellpadding="0"><tr><td width="560" valign="top" align="center"><table width="100%" cellspacing="0" cellpadding="0" role="presentation"><tr><td class="es-infoblock" align="center"><p><a target="_blank"></a>No longer want to receive these emails?&nbsp;<a href target="_blank">Unsubscribe</a>.<a target="_blank"></a></p></td></tr></table></td></tr></table></td></tr></table></td></tr></table></td></tr></table></div></body></html>

                """

        email.attach(MIMEText(html, "html"))

        context = ssl.create_default_context()
        with smtplib.SMTP_SSL("smtp.gmail.com", port=465, context=context) as server:
            server.login(email["From"], self.password)

            server.sendmail(email["From"], email["To"], email.as_string())


# try:
#     email = input("digite um email: ")
#     token = input("token: ")

#     print("Enviando ...")

#     my_email = Email(email, token)
#     my_email.send_email()

#     print("Emails enviado com sucesso!")

# except FileNotFoundError:
#     print("Gere o arquivo json com os email")
